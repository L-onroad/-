# HTTP 协议
重要性：

协议：一式双份/多份，双方/多方都遵从共同的一个规范，这个规范就可以称为协议。计算机能全世界互通，协议是功不可没的
>ftp  http  stmp  pop  tcp/ip 协议

# HTTP 工作流程
>
0：原始状态：客户端和服务器质检没有关系
>
客户端 --> 建立连接，发送请求 --> WEB 服务器
客户端 <-- 沿着连接，返回响应信息 <-- WEB 服务器
>
断开连接

# 请求信息和响应信息的格式

请求：
1. 请求行
	* 请求行分三部分：请求方法  请求路径（资源）  所用的协议
	* 请求方法：GET POST HEAD PUT DELETE TRACE OPTIONS
		* HEAD 和 GET 基本一致，只是**返回内容**
		* 注意：这些方法虽然是协议规定的，但是 Web server 不一定支持
1. 请求头信息    *头信息丰富，学习的重点*
	* 键值块
2. 空行   *头信息结束后，头信息和主体信息需要这个空行做区分，即使没有主体信息，空行也不能少*
3. 请求主体信息

响应：
1. 响应行
	* 响应行分三部分：协议  状态码  状态文字
2. 响应头信息    *头信息丰富，学习的重点*
	* 键值块
3. 空行   *头信息结束后，头信息和主体信息需要这个空行做区分，即使没有主体信息，空行也不能少*
4. 主体信息
```
案例：
//请求
请求行
请求行信息
空行
主体信息(可选)（发送内容）

//响应
响应行（）
响应头信息
key: value
key: value
（content-type: application/x-www-form-urlencoded post 需要加类型）
content-length: 接下来主体的长度
空行
内容主体
```

>POST 比 GET 多了主体信息 
>头信息里，要标明主体长度

# HTTP 响应中的状态码
|状态码|定义           |说明                                                    |
|1xx      |信息           |收到请求，继续处理                          |

|2xx      |成功           |操作成功地收到，理解和接受           |
|3xx      |重定向       |为了完成请求，必须采取进一步措施|
|4xx      |客户端错误|请求的语法有错误或不能完全被满足|

|5xx      |服务端错误|服务器无法完成明显有效的请求        |

200 - 服务器成功返回页面
301/2 - 永久/临时 重定向
**304 Not Modified - 未修改**
307 重定向中保持原有的请求数据

失败的状态码
404 -  请求的网页不存在
503 - 服务器暂时不可用
500 - 服务器内部错误

# HTTP 协议 referer 防盗链
>在 HTTP 协议中，头信息里有一个重要选项 referer 
>referer  代表网页的来源，即上一页的地址
>如果是直接在浏览器上输地址，则没有 referer 头
>所以服务器能得知图片的引用来源，也知道从哪个网站链接点击过来的

配置防盗链：
在 web 服务器层面，根据 HTTP 协议的 referer 头信息来判断，如果来自站外，则统一重写到一个很小的防盗链提醒图片上面 （URL 重写）

重写规则：

怎么重写：
统一 rewrite 到某个防盗链图片

# HTTP 缓存
>观察图片下载时，往往第一次请求时为 200 ok，第二次为 304 Not Modified

在网络上，有一些缓存服务器，另外，浏览器自身也有缓存功能
前提：图片不会经常改动，服务器在返回 200 的同时，还返回该图片的“签名”--Etag
当浏览器再次访问该图片，就会去服务器校验“签名”，如果图片没有变化，则直接使用缓存中的图片，这样减轻了服务器的负担

# HTTP 内容压缩
为了提高网页在网络上的传播速度，服务器对主体信息进行压缩
如常见的 gzip 压缩，deflate 压缩，compress 压缩以及 sdch 压缩

客户端允许发一个 Accept-Encoding 头信息与服务器协商，可以看出支持什么类型的浏览器

# 分块传输与反向 Ajax
